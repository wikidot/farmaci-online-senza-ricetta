name: PubSubHubbub Ping

on:
  push:
    branches: [main]
    
jobs:
  ping:
    runs-on: ubuntu-latest
    steps:
      - name: Wait for deployment
        run: sleep 600
        
      - name: Ping hubs
        run: |
          RSS_FEED_URL="https://farmaci-online-italia.pages.dev/index.xml"
          
          # Google PubSubHubbub
          echo "üîÑ Pinging Google PubSubHubbub..."
          STATUS=$(curl -X POST "https://pubsubhubbub.appspot.com/" \
            -d "hub.mode=publish" \
            -d "hub.url=$RSS_FEED_URL" \
            -H "Content-Type: application/x-www-form-urlencoded" \
            -s -o /dev/null -w "%{http_code}")
            
          if [[ "$STATUS" =~ ^(200|202|204)$ ]]; then
            echo "‚úÖ Google hub success! Status: $STATUS"
          else
            echo "‚ùå Google hub error! Status: $STATUS"
          fi
          
          # Superfeedr (–±–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏)
          echo "üîÑ Pinging Superfeedr..."
          STATUS=$(curl -X POST "https://pubsubhubbub.superfeedr.com/" \
            -d "hub.mode=publish" \
            -d "hub.url=$RSS_FEED_URL" \
            -H "Content-Type: application/x-www-form-urlencoded" \
            -s -o /dev/null -w "%{http_code}")
            
          if [[ "$STATUS" =~ ^(200|202|204)$ ]]; then
            echo "‚úÖ Superfeedr success! Status: $STATUS"
          else
            echo "‚ùå Superfeedr error! Status: $STATUS"
          fi