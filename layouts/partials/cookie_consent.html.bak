<!-- layouts/partials/cookie_consent.html -->
<!-- Подключение стилей и скрипта Cookie Consent -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/orestbida/cookieconsent@v3.0.1/dist/cookieconsent.css">
<script defer src="https://cdn.jsdelivr.net/gh/orestbida/cookieconsent@v3.0.1/dist/cookieconsent.umd.js"></script>

<!-- Инициализация Cookie Consent -->
<script defer>
    // Функция для запуска Cookie Consent после загрузки скрипта
    function loadCookieConsent() {
        if (typeof CookieConsent !== 'undefined') {
            CookieConsent.run({
                // Полный список настроек: https://github.com/orestbida/cookieconsent#configuration-parameters
                guiOptions: {
                    consentModal: {
                        layout: "box inline", // "box", "cloud", "bar"
                        position: "bottom right", // "bottom/middle/top" + "left/center/right"
                        equalWeightButtons: true,
                        flipButtons: false
                    },
                    preferencesModal: {
                        layout: "box",
                        position: "left",
                        equalWeightButtons: true,
                        flipButtons: false
                    }
                },
                onFirstConsent: ({ cookie }) => {
                    console.log("Согласие получено!", cookie);
                    // Здесь можно добавить код для загрузки сервисов, требующих согласия,
                    // например, Google Analytics, если пользователь дал согласие.
                    // Пример:
                    // if (CookieConsent.acceptedCategory('analytics')) {
                    //     // Загрузить Google Analytics
                    // }
                },
                onConsent: ({ cookie }) => {
                    console.log("Текущее согласие:", cookie);
                },
                onChange: ({ changedCategories, changedServices }) => {
                    console.log("Изменения согласия:", changedCategories, changedServices);
                    // Обработка изменений настроек пользователем
                },
                onModalReady: ({ modalName }) => {
                    console.log("Модальное окно готово:", modalName);
                },
                onModalShow: ({ modalName }) => {
                    console.log("Модальное окно показано:", modalName);
                },
                onModalHide: ({ modalName }) => {
                    console.log("Модальное окно скрыто:", modalName);
                },
                categories: {
                    necessary: {
                        enabled: true,  // Эти cookies обязательны, пользователь не может их отключить
                        readOnly: true  // Значение категории нельзя изменить
                    },
                    analytics: {
                        enabled: false,
                        readOnly: false
                    },
                    marketing: {
                        enabled: false,
                        readOnly: false
                    },
                    functionality: {
                        enabled: false,
                        readOnly: false
                   },
                    personalization: {
                         enabled: false,
                         readOnly: false
                    }
                },
                language: {
                    default: "it", // Язык по умолчанию
                    autoDetect: "document", // Попытаться определить язык из <html lang="...">
                    translations: {
                        it: {
                            consentModal: {
                                title: "Utilizziamo i cookie!",
                                description: "Ciao, questo sito web utilizza cookie essenziali per garantire il corretto funzionamento e cookie di tracciamento per comprendere come interagisci con esso. Il secondo tipo di cookie verrà impostato solo dopo il tuo consenso.",
                                acceptAllBtn: "Accetta tutto",
                                acceptNecessaryBtn: "Rifiuta tutto",
                                showPreferencesBtn: "Gestisci le preferenze"
                            },
                            preferencesModal: {
                                title: "Preferenze per il consenso ai cookie",
                                acceptAllBtn: "Accetta tutto",
                                savePreferencesBtn: "Salva le preferenze",
                                closeIconLabel: "Chiudi",
                                sections: [
                                    {
                                        title: "Utilizzo dei cookie",
                                        description: "Utilizzo i cookie per garantire la migliore esperienza sul mio sito web. Alcuni di questi sono essenziali per il funzionamento del sito web, mentre altri ci aiutano a migliorare il sito web e la tua esperienza. Puoi scegliere liberamente per i cookie non essenziali. Puoi anche rivedere e modificare le tue scelte in qualsiasi momento. Per ulteriori informazioni sulla nostra politica sui cookie e su come revocare il consenso, consulta la nostra Informativa sulla privacy."
                                    },
                                    {
                                        title: "Cookie strettamente necessari",
                                        description: "Questi cookie sono essenziali affinché il sito web funzioni correttamente. Senza questi cookie, il sito web non funzionerebbe correttamente.",
                                        linkedCategory: "necessary"
                                    },
                                    {
                                        title: "Cookie di prestazioni e analisi",
                                        description: "Questi cookie consentono al sito web di ricordare le scelte che hai fatto in passato.",
                                        linkedCategory: "analytics"
                                    },
                                    {
                                        title: "Cookie pubblicitari",
                                        description: "Questi cookie, e altri cookie di tracciamento di terze parti, vengono utilizzati per creare annunci personalizzati.",
                                        linkedCategory: "marketing"
                                    },
                                    {
                                        title: "Altri cookie funzionali",
                                         description: "Questi cookie vengono utilizzati per abilitare funzionalità aggiuntive del sito web.",
                                         linkedCategory: "functionality"
                                    },
                                    {
                                        title: "Cookie di personalizzazione",
                                         description: "Questi cookie vengono utilizzati per ricordare le tue preferenze e fornirti un'esperienza personalizzata.",
                                         linkedCategory: "personalization"
                                    }
                                ]
                            }
                        }
                        // Вы можете добавить другие языки здесь, например, en: { ... }
                    }
                }
            });
        } else {
            console.error("CookieConsent не загружен. Повторная попытка через 500мс.");
            setTimeout(loadCookieConsent, 500); // Повторить попытку, если скрипт ещё не загрузился
        }
    }

    // Запустить инициализацию, когда DOM полностью загружен
    if (document.readyState === "loading") {
        document.addEventListener("DOMContentLoaded", loadCookieConsent);
    } else {
        loadCookieConsent();
    }
</script>